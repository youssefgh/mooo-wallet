import { URDecoder } from '@ngraveio/bc-ur';
import { UrDecoderUtils } from '../src/app/core/ur-decoder-utils';

describe('UrDecoderUtils', () => {

  it(`should decode psbt`, () => {
    const urDecoder = new URDecoder();

    UrDecoderUtils.decode('UR:CRYPTO-PSBT/1543-3/LPCFAMATAXCFAOKSCYUEYTGRLUHDTEEMAYNSLYOEDECTKTKGTSNEPEMNAEAELOJLBERYTOLDRTHFAEAELAADAEAELAAEAEAELAAEADAELDAOAEAEAEADTISAFRPKGWSKBYGAZOJTADMKDRVDFDTLEOLNGWSTTYVAAERLFTMSFDMOKEEMCKWPADAEAEAEAEPSAXAEAEAOGAINAAAEAEAEAEAECPGYCXJKMURTCHCYROGWVDLNKOVOGSFWTALTSTSOMTWLVSKSBZJNKGHEEEOYGUGEFEKTGDBEDIAEAEAEAEAEAECPAECXDEOSKIAAGUZCFDSBCLGWDKMHCTFZMKWDAYONBDQDCEETNLSWJYSKBDMHCLECOSWLAEAEAEAEADADDNGAINAAAEAEAEAEAECPGYCXJKMURTCHCYROGWVDLNKOVOGSFWTALTSTSOMTWLVSKSBZZCIAIYEE', urDecoder);
    UrDecoderUtils.decode('UR:CRYPTO-PSBT/1535-3/LPCFAHZMAXCFAOKSCYUEYTGRLUHDTEAXJSRPSKJOCFCLSNBTLTCHPLLEAEAELDYKHFVTVAOYWMCNTEAXDATKHNLTRNREKOPFIAGUWEHLNYZSWZFYCPGEFLBZQZNSHGWNCPNBVOJTVSHDOTDICEHLCXAMGLSTTYIYAEMDFTEMHPFEINHLBWSFTYWSGRSKBAWSWMCWKIDNBDCLZSJLRKYTCTSGLSMYEELRJPIABZGDDWJEVEMSAABGGLMETKVWBAKPKKKKPSLSGUDIJLQDEEONLGTLUOSGNDZEKKBBDMWDCMOTJOKTEHSSSSSPGMBBCSPRTSJLLNCFDADTVEGLMSRSGLFDLDJYNSETCFSWZEPRZEHTGRHHSBOXOXVLFYIYOXNTLGIDRSKBURZOGERYASIMSEOTVLCPCXRLPAFZNLGEKEYLFDJKTLWFDPDTTOFSWSGYJZCNAEOSUOFX', urDecoder);
    const result = UrDecoderUtils.decode('UR:CRYPTO-PSBT/1546-3/LPCFAMBKAXCFAOKSCYUEYTGRLUHDTEHKAOKPJOJKIDJYZMADAELDAOAEAEAEADNYIOGRGLPATKROWEAEDWEOKEAELRFPCMMKPFMDPFMSNTSBATYNGUGSLNONLBEESBAEAEAEAEAEGHBAAEAEAOLOBWAEAEAEAEAEAECPAECXBGTSBZIMASCXTLWSGETDDMDAJSZMPFCHFPSEAXJKFNFXWMPKLDLGTDPYDNDPEHRSDSGOAAAEAEAEAEAECPGYCXRFWSPAFXCFPMSEZCZOSWJTHDBBSAMYPDUYWFURUEBNLBKTTKNDPRMEEOMNSKPYTOAEAEAEAEGWADAAECLTTKAXFGWEAOSWLAAEAEAELEKTKPSBIMINJZFDOXVLFYIONBRFFYRTHLMUSPFSCXFRLFBWOEVTONCEDNGDGTMEAOBGEEAOURVTKORTBYJEFDEEOECKBBENHDLNYKVT', urDecoder);

    expect(result.message).toEqual('cHNidP8BAIkCAAAAAZpnS06xz7jtACwzfACEQRaYsJWwl53LB/ZTTIalfzTLAAAAAABUDgAAAogTAAAAAAAAIgAgEtcVagkg1e9K0i4lcf+wF0HBA3M8Q+uqiY3SqystMb8mVQQAAAAAACJRILzvsUMZrcH9+8ZuWBTCj6jb89/eDH93z5uykTOOxavOAAAAAE8BBDWHzwNG7QLGgAAAAIp3dctqaWxIpONEZ6C8RMBdk8g9IDuCE6LgpRwrUE2RAhI0At/gdsARa0g0oh4UNjcInIGiKB93e9efr44AAIhvEL3OicBWAACAAQAAgAAAAIAAAQCJAgAAAAHQwjuqT8URSftuAZgq50jVM4ZPx9TmALc6l0iSfDce7AEAAAAArAMAAAJJaQQAAAAAACJRIHOTwBcauE/nhnbiTELZh8fJlunoeBVte180oVNKRXdQECcAAAAAAAAiACAop30EU/1IyyFPJJAfQJjqCKULsxw4mcZ0xQuQITWn6QAAAAABAStJaQQAAAAAACJRIHOTwBcauE/nhnbiTELZh8fJlunoeBVte180oVNKRXdQAQMEAAAAACEWZpnkzT4Dif0ch7r0YChTxlzKjjP1snEHEXLwAtM0M+kZAL3OicBWAACAAQAAgAAAAIABAAAABAAAAAEXIGaZ5M0+A4n9HIe69GAoU8Zcyo4z9bJxBxFy8ALTNDPpAAAhB+Lri+kXxmqGi1syYzWty/DmadS/zoN13+Hqu4VPn6SnGQC9zonAVgAAgAEAAIAAAACAAQAAAAUAAAABBSDi64vpF8ZqhotbMmM1rcvw5mnUv86Ddd/h6ruFT5+kpwA=');
    expect(result.error).toEqual(undefined);
  });

  it(`should decode bytes`, () => {
    const urDecoder = new URDecoder();

    UrDecoderUtils.decode('UR:BYTES/130-3/LPCSLFAXCSWMCYCSDMBBIDHDGWHSHPGSJKDIAOCTBEZTWPKKVLUEURWYGRSOAYTALRROBKIDDRDPFGTTHGYAWKDPSWPAZEWDVOVTUEADCLAXFPKNEOJKYLAXSWLDJPGLAAVYVSJOPDZEAMVLVWFDISJSURIHWMJKPKKPAMBZFZMWAEAEAEAEAEAEFYCHCXSO', urDecoder);
    UrDecoderUtils.decode('UR:BYTES/133-3/LPCSLPAXCSWMCYCSDMBBIDHDGWHDWLAOAEAEAEAEADADLKPRUYGLLBGRGAGMDPJPNDRNGOWPTYVWCARFJNRNUORTMYNDMYKGFHRFATHEEHEHADAEAEAEAEZMZMZMZMAOGDSRAEAEAEAEAEAECPAECXLKAADEYAOTYALUFSDWJKKBTBDSRNPAWEKILKZTSAVA', urDecoder);
    UrDecoderUtils.decode('UR:BYTES/136-3/LPCSLOAXCSWMCYCSDMBBIDHDGWHDWLAOAEAEAEAEADADLKPRUYGLLBGRGAGMDPJPNDRNGOWPTYVWCARFJNRNUORTMYNDMYKGFHRFATHEEHEHADAEAEAEAEZMZMZMZMAOGDSRAEAEAEAEAEAECPAECXLKAADEYAOTYALUFSDWJKKBTBDSRNPAWEKICXYALNCW', urDecoder);
    const result = UrDecoderUtils.decode('UR:BYTES/139-3/LPCSLUAXCSWMCYCSDMBBIDHDGWIDSONNPFUOWPFSFRTYASTOGRMDBZSOJYTIPEJPNDRNGOWPSAVWASWECEPYHYHLLTHFBYHGSGLRBEWLMKWSLTKNVDBTKEZCRHTKRFAEJOQDCXDMAYHELRMEJYDYTPDTKGBSGSGSFRGWLKZTRDTILFPTTLBBZOHYHKWTBSTK', urDecoder);

    expect(result.message).toEqual('020000000001018cb2db4e7f4b49522d729bbe55ecd4e51dbc6dbedcc08f9b8f7b3fbc075f31310100000000ffffffff0250c30000000000002200208c0428f8a3f88b3d2c737ed626beb1ed7d3a209cb0dcec3d3ad5857c90db6a823d82820000000000160014517115829d08cd9e2cf53817b6a9de867ae70d7c02463043022070202e085f84915630f8a57f27b4efc3c4b1d0c9ae548f6ba51623615b4c7327021f10fcec79e3dedfee4bc908d984b80a622a2d46d157f8f42dc6b1feeae2e0de012103417a3373f703c689724e04e1e870a8fe06e3e5486871df65eb73aa750615409400000000');
    expect(result.error).toEqual(undefined);
  });

  it(`should error when incompatible`, () => {
    const urDecoder = new URDecoder();

    const result = UrDecoderUtils.decode('ur:crypto-output/taadmutaadeyoyaxhdclaoswaalbmwfpwekijndyfefzjtmdrtketphhktmngrlkwsfnospypsasrhhhjonnvwtsqzwljy', urDecoder);

    expect(result.message).toEqual(undefined);
    expect(result.error).toBeDefined();
  });

});
