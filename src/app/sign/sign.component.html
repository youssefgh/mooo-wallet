<app-navigation-bar header="Sign"></app-navigation-bar>

<main>
    <div class="container">
        <div class="row valign-wrapper">
            <div class="input-field col s9 m10 l11 xl11">
                <textarea id="source" class="materialize-textarea" [(ngModel)]="unsignedTransaction"></textarea>
                <label for="source">Unsigned transaction</label>
            </div>
            <div class="col s3 m2 l1 xl1" style="margin-top: 1rem">
                <app-qr-code-reader (scanned)="onSourceQrScan($event)"></app-qr-code-reader>
            </div>
        </div>
        <div *ngIf="!psbt" class="row center-align">
            <a class="waves-effect waves-light btn-large" (click)="load()">
                <i class="material-icons left">system_update_alt</i>
                Load
            </a>
        </div>
        <div *ngIf="psbt" class="row">
            <div class="center-align">
                <h4>Sending :</h4>
                <h5 *ngFor="let walletDestination of psbtTransactionDetails.walletDestinationList"
                    style="word-wrap: break-word">
                    <span class="green-text">{{walletDestination.amount}} BTC</span>
                    =>
                    <span style="text-decoration: underline;">{{walletDestination.address}}</span>
                </h5>
            </div>
        </div>
        <div *ngIf="psbt?.signedTransaction" class="row">
            <div class="center-align">
                <h5>Fee:
                    <span class="red-text">
                        {{psbtTransactionDetails.fee}} sat ({{psbtTransactionDetails.feeRate}} sat/vB)
                    </span>
                </h5>
            </div>
        </div>
        <div *ngIf="psbt && !psbt.signedTransaction" class="row">
            <div class="col s12 input-field">
                <input id="mnemonic" type="text" [(ngModel)]="mnemonic.phrase" />
                <label for="mnemonic">Mnemonic</label>
            </div>
            <div class="col s12 input-field">
                <input id="passphrase" type="text" [(ngModel)]="mnemonic.passphrase" />
                <label for="passphrase">Passphrase</label>
            </div>
            <div class="center-align">
                <a class="waves-effect waves-light btn" (click)="sign()">Sign</a>
            </div>
        </div>
        <div *ngIf="psbt?.signedTransaction" class="row valign-wrapper">
            <div class="col s9">
                <label>Transaction</label>
                <div style="word-wrap: break-word">
                    {{psbt.signedTransaction}}
                </div>
            </div>
            <div class="col s3">
                <a class="waves-effect waves-light btn" (click)="showQr(psbt.signedTransaction)">QR</a>
            </div>
        </div>
        <div *ngIf="psbt?.signedTransaction" class="row">
            <div class="center-align">
                <a class="waves-effect waves-light btn" (click)="broadcast()">Broadcast</a>
            </div>
        </div>
        <div *ngIf="unsignedTransaction" class="row center-align">
            <div class="col s12" style="margin-top: 0.5rem">
                <a class="waves-effect waves-light btn orange" (click)="clear()">Clear</a>
            </div>
        </div>
    </div>
</main>
<div class="modal" style="width: 30vw; min-width: 300px" #qrModal>
    <div class="modal-content center-align">
        <app-qr-code [value]="selectedQr"></app-qr-code>
    </div>
    <div class="modal-footer" style="text-align: center">
        <a class="modal-close waves-effect waves-green btn-flat">Close</a>
    </div>
</div>